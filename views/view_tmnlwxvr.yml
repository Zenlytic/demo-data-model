version: 1
type: view
name: marketing_spend
fields:
  - name: revenue_from_paid_marketing
    field_type: dimension
    type: number
    hidden: true
    label: Revenue From Paid Marketing
    searchable: false
    sql: ${TABLE}.revenue_from_paid_marketing

  - name: customers_from_paid_marketing
    field_type: dimension
    type: number
    hidden: true
    label: Customers From Paid Marketing
    searchable: false
    sql: ${TABLE}.customers_from_paid_marketing

  - name: gross_profit_from_paid_marketing
    field_type: dimension
    type: number
    hidden: true
    label: Gross Profit From Paid Marketing
    searchable: false
    sql: ${TABLE}.gross_profit_from_paid_marketing

  - name: unique_key
    field_type: dimension
    type: string
    hidden: true
    label: Unique Key
    primary_key: true
    searchable: false
    sql: ${TABLE}.spend_id

  - name: channel
    field_type: dimension
    type: string
    label: Channel
    searchable: false
    sql: ${TABLE}.channel

  - name: source
    field_type: dimension
    type: string
    description: The source of the ad spend
    label: Source
    searchable: false
    sql: ${TABLE}.source

  - name: campaign
    field_type: dimension
    type: string
    description: The campaign of the ad spend
    label: Campaign
    searchable: false
    sql: ${TABLE}.campaign

  - name: ad_spend
    field_type: dimension
    type: string
    description: The amount spent
    hidden: true
    label: Ad Spend
    searchable: false
    sql: ${TABLE}.ad_spend

  - name: spend
    field_type: dimension_group
    type: time
    description: The date of the ad spend
    datatype: date
    label: Spend
    sql: ${TABLE}.spend_at
    timeframes:
      - date
      - week
      - month
      - quarter
      - year
      - day_of_year
      - week_of_year
      - month_of_year

  - name: total_marketing_spend
    field_type: measure
    type: sum
    description: Total marketing spend across all channels
    label: Total Marketing Spend
    sql: ${ad_spend}
    value_format_name: usd

  - name: cac
    field_type: measure
    type: number
    description: >-
      Cost of acquisition = Total marketing spend across all channels / number
      of new customers who placed orders in that period
    label: Cac
    sql: >-
      ${total_marketing_spend} / nullif(sum(${customers_from_paid_marketing}),
      0)
    value_format_name: usd

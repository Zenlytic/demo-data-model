version: 1
name: order_lines
type: view
model_name: pure_organics
sql_table_name: DEMO_PROD.ORDER_LINES
default_date: order
row_label: Order line
identifiers:
  - name: product_id
    type: foreign
    sql: ${product_id}
  - name: customer_id
    type: foreign
    sql: ${customer_id}
fields:
  - name: order_line_id
    field_type: dimension
    type: string
    hidden: 'yes'
    primary_key: 'yes'
    sql: ${TABLE}.ORDER_LINE_ID
    label_prefix: null
  - name: customer_id
    field_type: dimension
    type: string
    hidden: 'yes'
    drill_fields:
      - customers.email
      - customers.state
      - customers.city
      - customers.zipcode
    sql: ${TABLE}.CUSTOMER_ID
    tags:
      - customer
    label_prefix: null
  - name: order_id
    field_type: dimension
    type: string
    hidden: 'yes'
    drill_fields:
      - order_date
      - subscription_vs_otp
      - marketing_channel
      - campaign
      - promotion
      - total_gross_revenue
    sql: ${TABLE}.ORDER_ID
    tags:
      - order
    label_prefix: null
  - name: product_id
    field_type: dimension
    type: string
    hidden: 'yes'
    sql: ${TABLE}.PRODUCT_ID
    label_prefix: null
  - name: discount
    field_type: dimension
    type: number
    hidden: 'yes'
    sql: ${TABLE}.DISCOUNT
    label_prefix: null
  - name: revenue
    field_type: dimension
    type: number
    hidden: 'yes'
    sql: ${TABLE}.REVENUE
    label_prefix: null
  - name: price
    field_type: dimension
    type: number
    hidden: 'yes'
    sql: ${TABLE}.PRICE
    label_prefix: null
  - name: quantity
    field_type: dimension
    type: number
    hidden: 'yes'
    sql: ${TABLE}.QUANTITY
    label_prefix: null
  - name: campaign
    field_type: dimension
    type: string
    description: >-
      The marketing campaign that the customer came through before placing their
      order.
    sql: ${TABLE}.CAMPAIGN
    searchable: true
    drill_up: marketing_source
    label_prefix: null
  - name: promotion
    field_type: dimension
    type: string
    description: The promotion given to the customer for this order
    sql: ${TABLE}.PROMOTION
    searchable: true
    label_prefix: null
  - name: subscription_vs_otp
    field_type: dimension
    type: string
    description: Whether the order was from a subscription or a one time purchase (OTP)
    sql: ${TABLE}.SUBSCRIPTION_VS_OTP
    searchable: true
    label_prefix: null
  - name: marketing_source
    field_type: dimension
    type: string
    description: >-
      The marketing source that the customer came through before placing their
      order.
    sql: ${TABLE}.MARKETING_SOURCE
    searchable: true
    drill_up: marketing_channel
    drill_down: campaign
    label_prefix: null
  - name: marketing_channel
    field_type: dimension
    type: string
    description: >-
      The marketing channel that the customer came through before placing their
      order.
    sql: ${TABLE}.MARKETING_CHANNEL
    searchable: true
    drill_down: marketing_source
    label_prefix: null
  - name: last_click_marketing_channel
    field_type: dimension
    type: string
    description: >-
      The last click marketing channel that the customer came through before
      placing their order.
    sql: ${TABLE}.last_click
    label_prefix: null
  - name: first_click_marketing_channel
    field_type: dimension
    type: string
    description: >-
      The first click marketing channel that the customer came through before
      placing their order.
    sql: ${TABLE}.first_click
    label_prefix: null
  - name: new_vs_repeat
    field_type: dimension
    type: string
    description: >-
      Whether the customer placing the order was a new customer or a returning
      customer
    sql: ${TABLE}.new_vs_repeat
    searchable: true
    label_prefix: null
  - name: order
    field_type: dimension_group
    type: time
    datatype: timestamp
    description: >-
      The time at which the order was placed. This is the main time field to use
      for orders
    timeframes:
      - raw
      - date
      - week_index
      - week
      - month_of_year
      - month
      - quarter
      - year
    sql: ${TABLE}.ORDER_AT
    label_prefix: null
  - name: between_first_order_and_this_order
    field_type: dimension_group
    type: duration
    label: between first order and this order
    intervals:
      - day
      - week
      - month
      - quarter
      - year
    sql_start: ${customers.first_order_date}
    sql_end: ${order_date}
    label_prefix: null
  - name: total_gross_revenue
    field_type: measure
    type: sum
    label: Total Gross Revenue
    description: Total gross revenue = revenue from product sales + shipping revenues.
    value_format_name: usd
    sql: ${revenue}
    synonyms:
      - sales
      - revenue
    label_prefix: null
  - name: total_gross_revenue_from_advertising
    field_type: measure
    type: sum
    hidden: 'yes'
    description: Total gross revenue = revenue from product sales + shipping revenues
    value_format_name: usd
    sql: ${revenue}
    filters:
      - field: marketing_channel
        value: '-Organic'
    synonyms:
      - sales
      - revenue
    label_prefix: null
  - name: total_discounts
    field_type: measure
    type: sum
    description: All discounts applied to either the order or the product in the order
    value_format_name: usd
    sql: ${discount}
    label_prefix: null
  - name: total_net_revenue
    field_type: measure
    type: number
    description: Total net revenue = gross revenue - discounts
    value_format_name: usd
    sql: ${total_gross_revenue} - ${total_discounts}
    label_prefix: null
  - name: subscription_revenue
    field_type: measure
    type: sum
    description: >-
      Subscription revenue = gross revenue (product revenues + shipping, for
      subscriptions only)
    value_format_name: usd
    sql: ${revenue}
    filters:
      - field: subscription_vs_otp
        value: Subscription
    label_prefix: null
  - name: number_of_customers_with_orders
    field_type: measure
    type: count_distinct
    description: The unique number of customers who placed orders
    value_format_name: decimal_0
    sql: ${customer_id}
    label_prefix: null
  - name: number_of_new_customers_with_orders
    field_type: measure
    type: count_distinct
    description: The unique number of new customers who placed orders
    value_format_name: decimal_0
    sql: ${customer_id}
    filters:
      - field: new_vs_repeat
        value: New
    label_prefix: null
  - name: number_of_orders
    field_type: measure
    type: count_distinct
    description: The unique number of orders placed
    value_format_name: decimal_0
    sql: ${order_id}
    label_prefix: null
  - name: number_of_repeat_orders
    field_type: measure
    type: count_distinct
    description: >-
      The unique number of orders placed by customers who have placed at least
      one order before
    value_format_name: decimal_0
    sql: ${order_id}
    filters:
      - field: new_vs_repeat
        value: Repeat
    label_prefix: null
  - name: repurchase_rate
    field_type: measure
    type: number
    description: Repurchase rate = number of repeat orders / number of orders.
    value_format_name: percent_1
    sql: ${number_of_repeat_orders} / ${number_of_orders}
    synonyms:
      - Repeat order rate
    label_prefix: null
  - name: gross_aov
    field_type: measure
    type: number
    description: Gross AOV = gross revenues / number of orders
    value_format_name: usd
    sql: ${total_gross_revenue} / nullif(${number_of_orders}, 0)
    synonyms:
      - Average order value
    label_prefix: null
  - name: number_of_units
    field_type: measure
    type: sum
    description: >-
      The unique number of units purchased (e.g. customer orders: 2 lip gloss
      and 1 blush = 3 units sold)
    value_format_name: decimal_0
    sql: ${quantity}
    label_prefix: null
  - name: total_cogs
    field_type: measure
    type: sum
    label: Total COGS
    description: The allocated cost of goods sold to the order line
    value_format_name: usd
    sql: ${TABLE}.cogs
    label_prefix: null
  - name: gross_profit
    field_type: measure
    type: number
    description: The total net revenue - allocated cost of goods sold to the order line
    value_format_name: usd
    sql: ${total_net_revenue} - ${total_cogs}
    label_prefix: null
event_name: Purchase
fields_for_analysis:
  - subscription_vs_otp
  - marketing_source
  - marketing_channel
  - promotion
  - campaign
  - products.product_title
